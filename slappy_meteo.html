<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SLAPPY ‚Äî Meteo</title>
    <style>
        :root {
            --font-system: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --radius-card: 16px;
            --radius-small: 12px;
            --bg: #f5f5f5;
            --white: #ffffff;
            --text-dark: #1a1a1a;
            --text-medium: #555555;
            --text-light: #888888;
            --teal: #2a9d8f;
            --teal-light: #b2dfdb;
            --teal-border: #b2dfdb;
            --blue-light: #b3e5fc;
            --blue-border: #bbdefb;
            --green-light: #c8e6c9;
            --green-border: #c8e6c9;
            --yellow-light: #fff59d;
            --yellow-border: #fff9c4;
            --red-light: #ffcdd2;
            --red-border: #ffcdd2;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-900: #111827;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            font-family: var(--font-system);
            background: var(--bg);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
        }
        .app {
            width: 100%;
            max-width: 480px;
            min-height: 100vh;
            margin: 0 auto;
            background: var(--bg);
            overflow-y: auto;
            position: relative;
        }
        @media (min-width: 481px) {
            body { display: flex; justify-content: center; background: #e8e8e8; }
            .app { box-shadow: 0 0 60px rgba(0,0,0,0.1); }
        }

        /* HEADER - Verde acqua come home */
        .header {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            background: radial-gradient(ellipse at center, #3ab4a4 0%, #2a9d8f 100%);
            gap: 12px;
        }
        .header-back {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            color: white;
            font-size: 18px;
            text-decoration: none;
        }
        .header-content { flex: 1; }
        .header-title { font-size: 17px; font-weight: 600; color: white; }
        .header-subtitle { font-size: 12px; color: rgba(255,255,255,0.9); margin-top: 2px; }

        /* MAIN */
        .main {
            padding: 16px;
            padding-bottom: 100px;
        }

        /* SECTION */
        .section-title {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            margin-top: 16px;
            padding: 0 4px;
        }
        .section-title:first-child { margin-top: 0; }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-200);
            border-top-color: var(--teal);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* HERO CARD - Meteo principale */
        .hero-card {
            background: radial-gradient(ellipse at center, var(--white) 0%, var(--teal-light) 100%);
            border: 1px solid var(--teal-border);
            border-radius: var(--radius-card);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .hero-card.yellow {
            background: radial-gradient(ellipse at center, var(--white) 0%, var(--yellow-light) 100%);
            border-color: var(--yellow-border);
        }
        .hero-card.red {
            background: radial-gradient(ellipse at center, var(--white) 0%, var(--red-light) 100%);
            border-color: var(--red-border);
        }
        .hero-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .hero-temp-block {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .hero-icon {
            font-size: 48px;
        }
        .hero-temp {
            font-size: 42px;
            font-weight: 700;
            color: var(--text-dark);
        }
        .hero-feels {
            font-size: 12px;
            color: var(--text-medium);
        }
        .hero-right {
            text-align: right;
        }
        .hero-condition {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
        }
        .hero-minmax {
            font-size: 12px;
            color: var(--text-medium);
            margin-top: 4px;
        }
        .hero-bottom {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-top: 16px;
            border-top: 1px solid rgba(0,0,0,0.06);
        }
        .flag-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4ade80;
            box-shadow: 0 0 8px rgba(74, 222, 128, 0.6);
        }
        .flag-dot.yellow { background: #facc15; box-shadow: 0 0 8px rgba(250, 204, 21, 0.6); }
        .flag-dot.red { background: #ef4444; box-shadow: 0 0 8px rgba(239, 68, 68, 0.6); }
        .flag-text {
            flex: 1;
        }
        .flag-title {
            font-size: 14px;
            font-weight: 700;
            color: #166534;
        }
        .hero-card.yellow .flag-title { color: #854d0e; }
        .hero-card.red .flag-title { color: #991b1b; }
        .flag-desc {
            font-size: 11px;
            color: #15803d;
        }
        .hero-card.yellow .flag-desc { color: #a16207; }
        .hero-card.red .flag-desc { color: #b91c1c; }

        /* DETAILS CARD */
        .details-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-card);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .detail-item {
            text-align: center;
        }
        .detail-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        .detail-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
        }
        .detail-label {
            font-size: 9px;
            color: var(--text-light);
            text-transform: uppercase;
        }

        /* MAREE CARD */
        .maree-card {
            background: radial-gradient(ellipse at center, var(--white) 0%, var(--blue-light) 100%);
            border: 1px solid var(--blue-border);
            border-radius: var(--radius-card);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .maree-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }
        .maree-icon { font-size: 24px; }
        .maree-title { font-size: 14px; font-weight: 700; color: var(--text-dark); }
        .maree-graph {
            height: 60px;
            position: relative;
            margin-bottom: 12px;
            background: linear-gradient(to bottom, rgba(59,130,246,0.05) 0%, rgba(59,130,246,0.15) 100%);
            border-radius: 8px;
            overflow: hidden;
        }
        .maree-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,60 C150,20 350,100 600,60 C850,20 1050,100 1200,60 L1200,120 L0,120 Z' fill='rgba(59,130,246,0.2)'/%3E%3C/svg%3E") repeat-x;
            background-size: 600px 60px;
            animation: wave 8s linear infinite;
        }
        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 600px; }
        }
        .maree-markers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 0 10px;
        }
        .maree-marker {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
        }
        .maree-marker-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3b82f6;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 4px;
        }
        .maree-marker-dot.high { background: #ef4444; }
        .maree-marker-dot.low { background: #22c55e; }
        .maree-marker-dot.now { background: #f59e0b; }
        .maree-marker.high { align-self: flex-start; padding-top: 8px; }
        .maree-marker.low { align-self: flex-end; padding-bottom: 8px; }
        .maree-marker.now { align-self: center; }
        .maree-row {
            display: flex;
            justify-content: space-around;
        }
        .maree-item { text-align: center; }
        .maree-item-label { font-size: 9px; color: var(--text-light); text-transform: uppercase; }
        .maree-item-time { font-size: 14px; font-weight: 700; color: var(--text-dark); }
        .maree-item-level { font-size: 11px; color: var(--text-medium); }

        /* TIP CARD */
        .tip-card {
            background: radial-gradient(ellipse at center, var(--white) 0%, var(--green-light) 100%);
            border: 1px solid var(--green-border);
            border-radius: var(--radius-card);
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .tip-card:active { transform: scale(0.98); }
        .tip-icon {
            width: 44px;
            height: 44px;
            background: #22c55e;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        .tip-content { flex: 1; }
        .tip-title { font-size: 14px; font-weight: 700; color: #166534; }
        .tip-desc { font-size: 12px; color: #15803d; margin-top: 2px; }
        .tip-arrow { font-size: 20px; color: #166534; }

        /* FORECAST CARDS */
        .forecast-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .forecast-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-card);
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .forecast-card.today {
            background: radial-gradient(ellipse at center, var(--white) 0%, var(--teal-light) 100%);
            border-color: var(--teal-border);
        }
        .forecast-card.best {
            border: 2px solid #22c55e;
        }
        .forecast-day-col {
            width: 50px;
        }
        .forecast-day-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-dark);
        }
        .forecast-day-date {
            font-size: 10px;
            color: var(--text-light);
        }
        .forecast-icon-col {
            font-size: 32px;
            width: 40px;
            text-align: center;
        }
        .forecast-temps-col {
            flex: 1;
        }
        .forecast-temps {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-dark);
        }
        .forecast-temps-min {
            font-weight: 400;
            color: var(--text-light);
        }
        .forecast-rain {
            font-size: 11px;
            color: #3b82f6;
            margin-top: 2px;
        }
        .forecast-flag-col {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .forecast-flag-col.green { background: #dcfce7; }
        .forecast-flag-col.yellow { background: #fef9c3; }
        .forecast-flag-col.red { background: #fee2e2; }

        /* TAB BAR */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--white);
            padding: 12px 16px;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            display: flex;
            justify-content: space-around;
            gap: 12px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .tab-btn {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 5px;
            padding: 10px 8px;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .tab-btn:active { transform: scale(0.96); }
        .tab-btn-icon { font-size: 17px; }
        .tab-btn-label { font-size: 11px; font-weight: 700; color: var(--gray-900); }
        .tab-btn.meteo { background: radial-gradient(ellipse at center, #ffffff 0%, #fff59d 100%); border: 1px solid #fff9c4; }
        .tab-btn.trasporti { background: radial-gradient(ellipse at center, #ffffff 0%, #90caf9 100%); border: 1px solid #bbdefb; }
        .tab-btn.sos { background: radial-gradient(ellipse at center, #ffffff 0%, #ffcdd2 100%); border: 1px solid #ffcdd2; }
        .tab-btn.home { background: radial-gradient(ellipse at center, #ffffff 0%, #b2dfdb 100%); border: 1px solid #b2dfdb; }
    </style>
</head>
<body>
<div class="app">
    <!-- HEADER -->
    <header class="header">
        <a href="index.html" class="header-back">‚Üê</a>
        <div class="header-content">
            <div class="header-title">Meteo</div>
            <div class="header-subtitle">Cavallino-Treporti</div>
        </div>
    </header>

    <!-- MAIN -->
    <main class="main" id="mainContent">
        <div class="loading">
            <div class="loading-spinner"></div>
            <p style="margin-top: 10px;">Caricamento dati meteo...</p>
        </div>
    </main>

    <!-- TAB BAR -->
    <nav class="tab-bar">
        <a href="index.html" class="tab-btn home">
            <span class="tab-btn-icon">üè†</span>
            <span class="tab-btn-label">Home</span>
        </a>
        <a href="slappy_meteo.html" class="tab-btn meteo">
            <span class="tab-btn-icon">üå§Ô∏è</span>
            <span class="tab-btn-label">Meteo</span>
        </a>
        <a href="slappy_trasporti.html" class="tab-btn trasporti">
            <span class="tab-btn-icon">üöå</span>
            <span class="tab-btn-label">Trasporti</span>
        </a>
        <a href="slappy_sos.html" class="tab-btn sos">
            <span class="tab-btn-icon">üÜò</span>
            <span class="tab-btn-label">SOS</span>
        </a>
    </nav>
</div>

<script>
// Weather code mapping
const weatherCodes = {
    0: { icon: '‚òÄÔ∏è', desc: 'Sereno' },
    1: { icon: 'üå§Ô∏è', desc: 'Prev. sereno' },
    2: { icon: '‚õÖ', desc: 'Parz. nuvoloso' },
    3: { icon: '‚òÅÔ∏è', desc: 'Nuvoloso' },
    45: { icon: 'üå´Ô∏è', desc: 'Nebbia' },
    48: { icon: 'üå´Ô∏è', desc: 'Nebbia gelata' },
    51: { icon: 'üå¶Ô∏è', desc: 'Pioggerella' },
    53: { icon: 'üå¶Ô∏è', desc: 'Pioggerella' },
    55: { icon: 'üå¶Ô∏è', desc: 'Pioggerella' },
    61: { icon: 'üåßÔ∏è', desc: 'Pioggia leggera' },
    63: { icon: 'üåßÔ∏è', desc: 'Pioggia' },
    65: { icon: 'üåßÔ∏è', desc: 'Pioggia forte' },
    71: { icon: 'üå®Ô∏è', desc: 'Neve leggera' },
    73: { icon: 'üå®Ô∏è', desc: 'Neve' },
    75: { icon: 'üå®Ô∏è', desc: 'Neve forte' },
    80: { icon: 'üå¶Ô∏è', desc: 'Rovesci' },
    81: { icon: 'üåßÔ∏è', desc: 'Rovesci' },
    82: { icon: '‚õàÔ∏è', desc: 'Temporale' },
    95: { icon: '‚õàÔ∏è', desc: 'Temporale' },
    96: { icon: '‚õàÔ∏è', desc: 'Temporale grandine' },
    99: { icon: '‚õàÔ∏è', desc: 'Temporale grandine' }
};

const dayNames = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
const monthNames = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];

// Maree statiche per Punta Sabbioni (dati tipici)
const tidesData = {
    high: { time: '13:24', level: '+82' },
    low: { time: '19:48', level: '-8' },
    now: '+52'
};

function getWeatherInfo(code) {
    return weatherCodes[code] || { icon: 'üå°Ô∏è', desc: 'N/D' };
}

function getFlagStatus(weatherCode, windSpeed, waveHeight) {
    // Logica semplificata per determinare la bandiera
    if (weatherCode >= 95 || windSpeed > 40 || waveHeight > 1.5) {
        return { color: 'red', title: 'Bandiera Rossa', desc: 'Bagno vietato' };
    }
    if (weatherCode >= 61 || windSpeed > 25 || waveHeight > 0.8) {
        return { color: 'yellow', title: 'Bandiera Gialla', desc: 'Bagno con cautela' };
    }
    return { color: 'green', title: 'Bandiera Verde', desc: 'Balneazione sicura' };
}

function getUVLevel(uv) {
    if (uv <= 2) return 'Basso';
    if (uv <= 5) return 'Moderato';
    if (uv <= 7) return 'Alto';
    if (uv <= 10) return 'Molto alto';
    return 'Estremo';
}

async function loadWeatherData() {
    try {
        // Fetch weather data
        const weatherUrl = 'https://api.open-meteo.com/v1/forecast?latitude=45.458&longitude=12.508&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m,wind_direction_10m,relative_humidity_2m,uv_index&daily=temperature_2m_max,temperature_2m_min,weather_code,precipitation_probability_max&timezone=Europe/Rome&forecast_days=7';

        // Fetch marine data
        const marineUrl = 'https://marine-api.open-meteo.com/v1/marine?latitude=45.458&longitude=12.508&current=wave_height,sea_surface_temperature&daily=wave_height_max&timezone=Europe/Rome&forecast_days=7';

        const [weatherRes, marineRes] = await Promise.all([
            fetch(weatherUrl),
            fetch(marineUrl)
        ]);

        const weather = await weatherRes.json();
        const marine = await marineRes.json();

        renderWeatherPage(weather, marine);

    } catch (error) {
        console.error('Errore caricamento dati:', error);
        document.getElementById('mainContent').innerHTML = `
            <div class="loading">
                <p>Errore nel caricamento dei dati meteo.</p>
                <p style="font-size: 12px; margin-top: 8px;">Riprova pi√π tardi.</p>
            </div>
        `;
    }
}

function renderWeatherPage(weather, marine) {
    const current = weather.current;
    const daily = weather.daily;
    const currentMarine = marine.current;
    const dailyMarine = marine.daily;

    const weatherInfo = getWeatherInfo(current.weather_code);
    const flag = getFlagStatus(current.weather_code, current.wind_speed_10m, currentMarine?.wave_height || 0);

    const todayDate = new Date();

    let html = `
        <!-- HERO CARD -->
        <div class="hero-card ${flag.color === 'green' ? '' : flag.color}">
            <div class="hero-top">
                <div class="hero-temp-block">
                    <span class="hero-icon">${weatherInfo.icon}</span>
                    <div>
                        <div class="hero-temp">${Math.round(current.temperature_2m)}¬∞</div>
                        <div class="hero-feels">Percepita ${Math.round(current.apparent_temperature)}¬∞</div>
                    </div>
                </div>
                <div class="hero-right">
                    <div class="hero-condition">${weatherInfo.desc}</div>
                    <div class="hero-minmax">Min ${Math.round(daily.temperature_2m_min[0])}¬∞ / Max ${Math.round(daily.temperature_2m_max[0])}¬∞</div>
                </div>
            </div>
            <div class="hero-bottom">
                <div class="flag-dot ${flag.color}"></div>
                <div class="flag-text">
                    <div class="flag-title">${flag.title}</div>
                    <div class="flag-desc">${flag.desc}</div>
                </div>
            </div>
        </div>

        <!-- DETAILS -->
        <div class="section-title">Dettagli</div>
        <div class="details-card">
            <div class="details-grid">
                <div class="detail-item">
                    <div class="detail-icon">üå°Ô∏è</div>
                    <div class="detail-value">${currentMarine?.sea_surface_temperature ? Math.round(currentMarine.sea_surface_temperature) + '¬∞C' : 'N/D'}</div>
                    <div class="detail-label">Acqua</div>
                </div>
                <div class="detail-item">
                    <div class="detail-icon">üåä</div>
                    <div class="detail-value">${currentMarine?.wave_height ? currentMarine.wave_height.toFixed(1) + 'm' : 'N/D'}</div>
                    <div class="detail-label">Onde</div>
                </div>
                <div class="detail-item">
                    <div class="detail-icon">‚òî</div>
                    <div class="detail-value">${daily.precipitation_probability_max[0]}%</div>
                    <div class="detail-label">Pioggia</div>
                </div>
                <div class="detail-item">
                    <div class="detail-icon">üí®</div>
                    <div class="detail-value">${Math.round(current.wind_speed_10m)} km/h</div>
                    <div class="detail-label">Vento</div>
                </div>
                <div class="detail-item">
                    <div class="detail-icon">‚òÄÔ∏è</div>
                    <div class="detail-value">${Math.round(current.uv_index)}</div>
                    <div class="detail-label">UV ${getUVLevel(current.uv_index)}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-icon">üíß</div>
                    <div class="detail-value">${current.relative_humidity_2m}%</div>
                    <div class="detail-label">Umidit√†</div>
                </div>
            </div>
        </div>

        <!-- MAREE -->
        <div class="section-title">Maree Oggi</div>
        <div class="maree-card">
            <div class="maree-header">
                <span class="maree-icon">üåä</span>
                <span class="maree-title">Punta Sabbioni</span>
            </div>
            <div class="maree-graph">
                <div class="maree-wave"></div>
                <div class="maree-markers">
                    <div class="maree-marker high">
                        <div class="maree-marker-dot high"></div>
                    </div>
                    <div class="maree-marker now">
                        <div class="maree-marker-dot now"></div>
                    </div>
                    <div class="maree-marker low">
                        <div class="maree-marker-dot low"></div>
                    </div>
                </div>
            </div>
            <div class="maree-row">
                <div class="maree-item">
                    <div class="maree-item-label">Alta Marea</div>
                    <div class="maree-item-time">${tidesData.high.time}</div>
                    <div class="maree-item-level">${tidesData.high.level} cm</div>
                </div>
                <div class="maree-item">
                    <div class="maree-item-label">Adesso</div>
                    <div class="maree-item-time">${tidesData.now} cm</div>
                    <div class="maree-item-level">‚ÜóÔ∏è In salita</div>
                </div>
                <div class="maree-item">
                    <div class="maree-item-label">Bassa Marea</div>
                    <div class="maree-item-time">${tidesData.low.time}</div>
                    <div class="maree-item-level">${tidesData.low.level} cm</div>
                </div>
            </div>
        </div>

        <!-- TIP CARD -->
        <a href="slappy_fortini.html" class="tip-card">
            <div class="tip-icon">üí°</div>
            <div class="tip-content">
                <div class="tip-title">${flag.color === 'green' ? 'Ideale per escursioni' : flag.color === 'yellow' ? 'Attivit√† con prudenza' : 'Meglio attivit√† indoor'}</div>
                <div class="tip-desc">${flag.color === 'green' ? 'Bici sui fortini consigliata' : flag.color === 'yellow' ? 'Controlla il meteo prima di uscire' : 'Musei o shopping consigliati'}</div>
            </div>
            <span class="tip-arrow">‚Ä∫</span>
        </a>

        <!-- FORECAST 7 GIORNI -->
        <div class="section-title">Prossimi 7 Giorni</div>
        <div class="forecast-grid">
    `;

    // Generate forecast cards
    for (let i = 0; i < 7; i++) {
        const date = new Date(daily.time[i]);
        const dayName = i === 0 ? 'Oggi' : dayNames[date.getDay()];
        const dateStr = `${date.getDate()} ${monthNames[date.getMonth()]}`;
        const dayWeather = getWeatherInfo(daily.weather_code[i]);
        const dayWaveHeight = dailyMarine?.wave_height_max?.[i] || 0;
        const dayFlag = getFlagStatus(daily.weather_code[i], 15, dayWaveHeight); // Wind estimate for forecast
        const rainProb = daily.precipitation_probability_max[i];

        // Find best day (highest temp, lowest rain, green flag)
        const isBest = i > 0 && dayFlag.color === 'green' && rainProb < 20 && daily.temperature_2m_max[i] === Math.max(...daily.temperature_2m_max.slice(1));

        html += `
            <div class="forecast-card ${i === 0 ? 'today' : ''} ${isBest ? 'best' : ''}">
                <div class="forecast-day-col">
                    <div class="forecast-day-name">${dayName}</div>
                    <div class="forecast-day-date">${dateStr}</div>
                </div>
                <div class="forecast-icon-col">${dayWeather.icon}</div>
                <div class="forecast-temps-col">
                    <div class="forecast-temps">
                        ${Math.round(daily.temperature_2m_max[i])}¬∞
                        <span class="forecast-temps-min">/ ${Math.round(daily.temperature_2m_min[i])}¬∞</span>
                    </div>
                    ${rainProb > 0 ? `<div class="forecast-rain">‚òî ${rainProb}%</div>` : ''}
                </div>
                <div class="forecast-flag-col ${dayFlag.color}">
                    ${dayFlag.color === 'green' ? '‚úÖ' : dayFlag.color === 'yellow' ? '‚ö†Ô∏è' : '‚õî'}
                </div>
            </div>
        `;
    }

    html += '</div>';

    document.getElementById('mainContent').innerHTML = html;
}

// Load data on page load
document.addEventListener('DOMContentLoaded', loadWeatherData);
</script>
</body>
</html>
